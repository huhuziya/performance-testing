知识补充
=================  
### Jmeter分布式压测原理
[参考链接](https://blog.csdn.net/weixin_44275820/article/details/108233954)
- 控制机的节点叫master，其他产生压力的机器叫slaves ，即负载机  
- master会把压测脚本发送到 slaves上面  
- 执行的时候，slaves上只需要把jmeter-server打开就可以了，不用启动jmeter  
- 结束后，slaves会把压测数据回传给master,然后master汇总输出报告和配置详情  

> 注意：必须保证master和slaves安装相同的jdk和jmeter  
> 前提：master的jmeter可以正常打开使用，master和slaves处于同一个局域网下，相互之间可以ping通

### API网关
[参考链接](https://vincentruan.github.io/2020/02/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1-API%E7%BD%91%E5%85%B3/)

1. 协议转换：每个系统使用的协议不同，系统之间的调用或者数据传输，存在协议的转化问题  
处理方法：API网关通过泛化调用的方式实现协议之间的转化
2. 异步请求：如果把网络请求看成一次 IO 操作的话，处理请求的线程，从接受请求，到服务返回响应，都是阻塞状态。  
处理方法：一旦，发现请求事件，就会调用对应的应用。获取应用返回的信息以后，按照请求的要求把数据/文件放到指定的缓冲区，同时发送一个通知事件，告诉请求端数据已经就绪，可以从这个缓冲获取数据/文件。
3. 负载均衡：高可用网络基础架构的关键组件，通常用于将工作负载分布到多个服务器来提高网站、应用、数据库或其他服务的性能和可靠性。
4. 统一鉴权：访问应用服务器的请求都需要拥有一定权限，如果说每访问一个服务都需要验证一次权限，这个对效率是很大的影响。可以把权限认证放到 API 网关来进行。  
例子：用户通过登录服务获取 Token，把它存放到客户端，在每次请求的时候把这个 Token 放入请求头，一起发送给服务器。API 网关要做的事情就是解析这个 Token，知道访问者是谁（鉴定），他能做什么/访问什么（权限）。
5. 缓存数据：
- 用户请求先访问 API 网关，如果发现有缓存信息，直接返回给用户。
- 如果没有发现缓存信息，回源到应用服务器获取信息。
- 另外，有一个缓存更新服务，定期把应用服务器中的信息更新到网关本地缓存中。
![示例](https://vincentruan.github.io/2020/02/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1-API%E7%BD%91%E5%85%B3/640-1582786344099.webp)

### 压测经验总结
#### 为什么jmeter要做分布式，为什么会遇到内存溢出的错误？
- 前言：因为jmeter是java写的应用，java应用jvm堆内存heap受负载机硬件限制，虽然我们可以调整堆内存大小，但是单机无法支撑数以万计大并发，此时，需要多个负载机进行分压测试，这样性能瓶颈就不会受负载机硬件限制  

#### 服务器监控的jar包没启动起来
压测接口会报ERROR:java.net.ConnectException:Connection refused:connect  
处理方法：需要开发启用该服务

#### 数据库存在缓存，拿的都是缓存的数据
问题：同一份问卷反复压，测试使用的问卷相关参数都是一样，数据库里都是热数据，导致压测结果不准确
处理方法1：每次压测都更换问卷id，确保数据都是最新的，不是拿的缓存
处理方法2：测试完我重启数据库

#### TPS偏低
处理方法：开发对接口的SQL调整，优化sql查询索引

#### 压测脚本和运行界面不要同时打开，会报错

#### ping通压测机方法
ping 压测接口域名 [内网IP]
ping master机的IP [slaves机的IP]
> 前提:一定要保证master和slaves安装相同的jdk和jmeter，master和slaves处于同一个局域网下，相互之间可以ping通

#### 调试压测环境，打开错误日志，勾选仅错误日志选项
注意：压测时需取消勾选【仅错误日志】选项，以免打印日志信息影响压测结果  
打开日志与jmeter界面右上方叹号

#### 为了去掉token鉴权影响，使用内部接口来压测

#### 要提前结束压测ctrl+c,要重新启动分布式压测，请重新启动slaves

#### Http和Https的默认端口是什么
Apache server (Http)的默认端口是80  
SSL (Https)的默认端口是443

#### HTTP错误码
400无法解析此请求  
403禁止访问：访问被拒绝  
404找不到文件或目录  
405用于访问该页的HTTP动作未被许可  
410文件已删除  
500服务器内部错误  
501标题值指定的配置没有执行  
502 Web服务器作为网关或代理服务器时收到无效的响应  
